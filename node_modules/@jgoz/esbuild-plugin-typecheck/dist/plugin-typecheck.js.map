{
  "version": 3,
  "sources": ["../../../node_modules/.pnpm/picocolors@1.0.0/node_modules/picocolors/picocolors.js", "../src/index.ts", "../src/typecheck-runner.ts", "../src/typecheck-plugin.ts"],
  "sourcesContent": ["let tty = require(\"tty\")\n\nlet isColorSupported =\n\t!(\"NO_COLOR\" in process.env || process.argv.includes(\"--no-color\")) &&\n\t(\"FORCE_COLOR\" in process.env ||\n\t\tprocess.argv.includes(\"--color\") ||\n\t\tprocess.platform === \"win32\" ||\n\t\t(tty.isatty(1) && process.env.TERM !== \"dumb\") ||\n\t\t\"CI\" in process.env)\n\nlet formatter =\n\t(open, close, replace = open) =>\n\tinput => {\n\t\tlet string = \"\" + input\n\t\tlet index = string.indexOf(close, open.length)\n\t\treturn ~index\n\t\t\t? open + replaceClose(string, close, replace, index) + close\n\t\t\t: open + string + close\n\t}\n\nlet replaceClose = (string, close, replace, index) => {\n\tlet start = string.substring(0, index) + replace\n\tlet end = string.substring(index + close.length)\n\tlet nextIndex = end.indexOf(close)\n\treturn ~nextIndex ? start + replaceClose(end, close, replace, nextIndex) : start + end\n}\n\nlet createColors = (enabled = isColorSupported) => ({\n\tisColorSupported: enabled,\n\treset: enabled ? s => `\\x1b[0m${s}\\x1b[0m` : String,\n\tbold: enabled ? formatter(\"\\x1b[1m\", \"\\x1b[22m\", \"\\x1b[22m\\x1b[1m\") : String,\n\tdim: enabled ? formatter(\"\\x1b[2m\", \"\\x1b[22m\", \"\\x1b[22m\\x1b[2m\") : String,\n\titalic: enabled ? formatter(\"\\x1b[3m\", \"\\x1b[23m\") : String,\n\tunderline: enabled ? formatter(\"\\x1b[4m\", \"\\x1b[24m\") : String,\n\tinverse: enabled ? formatter(\"\\x1b[7m\", \"\\x1b[27m\") : String,\n\thidden: enabled ? formatter(\"\\x1b[8m\", \"\\x1b[28m\") : String,\n\tstrikethrough: enabled ? formatter(\"\\x1b[9m\", \"\\x1b[29m\") : String,\n\tblack: enabled ? formatter(\"\\x1b[30m\", \"\\x1b[39m\") : String,\n\tred: enabled ? formatter(\"\\x1b[31m\", \"\\x1b[39m\") : String,\n\tgreen: enabled ? formatter(\"\\x1b[32m\", \"\\x1b[39m\") : String,\n\tyellow: enabled ? formatter(\"\\x1b[33m\", \"\\x1b[39m\") : String,\n\tblue: enabled ? formatter(\"\\x1b[34m\", \"\\x1b[39m\") : String,\n\tmagenta: enabled ? formatter(\"\\x1b[35m\", \"\\x1b[39m\") : String,\n\tcyan: enabled ? formatter(\"\\x1b[36m\", \"\\x1b[39m\") : String,\n\twhite: enabled ? formatter(\"\\x1b[37m\", \"\\x1b[39m\") : String,\n\tgray: enabled ? formatter(\"\\x1b[90m\", \"\\x1b[39m\") : String,\n\tbgBlack: enabled ? formatter(\"\\x1b[40m\", \"\\x1b[49m\") : String,\n\tbgRed: enabled ? formatter(\"\\x1b[41m\", \"\\x1b[49m\") : String,\n\tbgGreen: enabled ? formatter(\"\\x1b[42m\", \"\\x1b[49m\") : String,\n\tbgYellow: enabled ? formatter(\"\\x1b[43m\", \"\\x1b[49m\") : String,\n\tbgBlue: enabled ? formatter(\"\\x1b[44m\", \"\\x1b[49m\") : String,\n\tbgMagenta: enabled ? formatter(\"\\x1b[45m\", \"\\x1b[49m\") : String,\n\tbgCyan: enabled ? formatter(\"\\x1b[46m\", \"\\x1b[49m\") : String,\n\tbgWhite: enabled ? formatter(\"\\x1b[47m\", \"\\x1b[49m\") : String,\n})\n\nmodule.exports = createColors()\nmodule.exports.createColors = createColors\n", "export * from './typecheck-plugin';\nexport * from './typecheck-runner';\nexport * from './types';\n", "import type { notify as lrNotify } from '@jgoz/esbuild-plugin-livereload';\nimport type { Message, WatchMode } from 'esbuild';\nimport path from 'path';\nimport pc from 'picocolors';\nimport { Worker } from 'worker_threads';\n\nimport type { Logger, TypecheckPluginOptions } from './types';\nimport type { TypescriptWorkerOptions, WorkerMessage } from './typescript-worker';\n\nconst SUCCESS = process.platform === 'win32' ? '\u221A' : '\u2714';\nconst WARNING = process.platform === 'win32' ? '\u203C' : '\u26A0';\nconst ERROR = process.platform === 'win32' ? '\u00D7' : '\u2716';\nconst INFO = process.platform === 'win32' ? 'i' : '\u2139';\n\nconst DEFAULT_LOGGER: Logger = {\n  info(message) {\n    console.info(pc.bold(INFO) + '  ' + message);\n  },\n  warn(message) {\n    console.warn(pc.bold(pc.yellow(WARNING)) + '  ' + message);\n  },\n  error(message) {\n    console.error(pc.bold(pc.red(ERROR)) + '  ' + message);\n  },\n  success(message) {\n    console.info(pc.bold(SUCCESS) + '  ' + pc.green(message));\n  },\n};\n\nconst BUILD_MSG: WorkerMessage = { type: 'build' };\n\nlet notify: typeof lrNotify = () => {};\ntry {\n  // eslint-disable-next-line @typescript-eslint/no-var-requires\n  notify = require('@jgoz/esbuild-plugin-livereload').notify;\n} catch {}\n\nexport interface TypecheckRunnerOptions extends Omit<TypecheckPluginOptions, 'watch'> {\n  absWorkingDir: string;\n  watch?: boolean | WatchMode;\n}\n\nexport class TypecheckRunner {\n  configPath: string;\n  logger: Logger;\n  worker: Worker;\n\n  constructor({\n    absWorkingDir: basedir,\n    logger = DEFAULT_LOGGER,\n    omitStartLog,\n    watch,\n    ...options\n  }: TypecheckRunnerOptions) {\n    const inputConfigFile = options.configFile;\n    const configFile = inputConfigFile\n      ? path.isAbsolute(inputConfigFile)\n        ? inputConfigFile\n        : path.resolve(basedir, inputConfigFile)\n      : undefined;\n\n    const workerData: TypescriptWorkerOptions = {\n      ...options,\n      basedir,\n      configFile,\n      watch: !!watch,\n    };\n\n    this.configPath = configFile ?? basedir;\n    this.logger = logger;\n    this.worker = new Worker(path.resolve(__dirname, './typescript-worker.js'), { workerData });\n\n    let errors: Message[] = [];\n    let warnings: Message[] = [];\n    let isBuilding: boolean | undefined;\n    let isWatching: boolean | undefined;\n\n    this.worker.on('message', (msg: WorkerMessage) => {\n      switch (msg.type) {\n        case 'start': {\n          errors = [];\n          warnings = [];\n          isBuilding ??= msg.build;\n          isWatching ??= msg.watch;\n          if (!omitStartLog) logStarted(logger, { build: isBuilding, watch: isWatching });\n          break;\n        }\n        case 'summary':\n        case 'diagnostic': {\n          errors.push(...msg.diagnostics.filter(d => d.type === 'error').map(d => d.message));\n          warnings.push(...msg.diagnostics.filter(d => d.type === 'warning').map(d => d.message));\n          console.error(pc.isColorSupported ? msg.output.pretty : msg.output.standard);\n          break;\n        }\n        case 'done': {\n          notify('typecheck-plugin', { errors, warnings });\n\n          if (msg.errorCount) {\n            logFailed(\n              logger,\n              msg.errorCount === 1 ? '1 error' : `${msg.errorCount} errors`,\n              msg.duration,\n            );\n            process.exitCode = 1;\n          } else {\n            logPassed(logger, msg.duration);\n            process.exitCode = 0;\n          }\n\n          break;\n        }\n        case 'build':\n          throw new Error('Unexpected message from worker: ' + JSON.stringify(msg));\n      }\n    });\n\n    this.worker.on('error', e => {\n      console.error(e);\n      process.exitCode = 1;\n    });\n\n    this.worker.on('exit', code => {\n      if (code !== 0) process.exitCode = code;\n    });\n  }\n\n  start() {\n    this.worker.postMessage(BUILD_MSG);\n  }\n}\n\nfunction logStarted(logger: Logger, { build = false, watch = false } = {}) {\n  const opts = [build && 'build', watch && 'watch'].filter(Boolean).join(', ');\n  const optStr = opts ? pc.cyan(` (${opts})`) : '';\n\n  logger.info('Typecheck started\u2026' + optStr);\n}\n\nfunction logPassed(logger: Logger, duration: number) {\n  logger.success('Typecheck passed');\n  logger.info(pc.gray(`Typecheck finished in ${duration.toFixed(0)}ms`));\n}\n\nfunction logFailed(logger: Logger, numErrors: string, duration: number) {\n  logger.error(`Typecheck failed with ${pc.bold(numErrors)}`);\n  logger.info(pc.gray(`Typecheck finished in ${duration.toFixed(0)}ms`));\n}\n", "import type { Plugin } from 'esbuild';\n\nimport { TypecheckRunner } from './typecheck-runner';\nimport type { TypecheckPluginOptions } from './types';\n\nexport function typecheckPlugin({\n  configFile,\n  watch: forceWatch,\n  ...options\n}: TypecheckPluginOptions = {}): Plugin {\n  return {\n    name: 'typecheck-plugin',\n    setup(build) {\n      const { absWorkingDir = process.cwd(), tsconfig, watch } = build.initialOptions;\n\n      const runner = new TypecheckRunner({\n        ...options,\n        absWorkingDir,\n        configFile: configFile ?? tsconfig,\n        watch: !!forceWatch || !!watch,\n      });\n\n      build.onStart(() => {\n        runner.start();\n      });\n    },\n  };\n}\n"],
  "mappings": "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",
  "names": ["module", "pc", "path"]
}
